# DB ì•Œë¦¼ ëª¨ë‹ˆí„°ë§ ì‹œìŠ¤í…œ

**íƒ€ê²Ÿ í”„ë¡œì íŠ¸ ì½”ë“œ ìˆ˜ì • ì—†ì´ ì™¸ë¶€ì—ì„œ ë…ë¦½ ì‹¤í–‰ë˜ëŠ” MSSQL ëª¨ë‹ˆí„°ë§ ë„êµ¬**

---

## ğŸ“Œ í•µì‹¬ íŠ¹ì§•

- âœ… **ì™¸ë¶€ ë…ë¦½ ì‹¤í–‰** - íƒ€ê²Ÿ í”„ë¡œì íŠ¸(SDMS, AutoCRM) ì½”ë“œ ìˆ˜ì • ë¶ˆí•„ìš”
- âœ… **ë°±ê·¸ë¼ìš´ë“œ ì‹¤í–‰** - UI ì—†ì´ ì™„ì „ ë…ë¦½ ì‹¤í–‰
- âœ… **ì‹¤ì‹œê°„ ê°ì§€** - ëŠë¦° ì¿¼ë¦¬, ì°¨ë‹¨, ë†’ì€ CPU, ë°ë“œë½
- âœ… **ë‹¤ì±„ë„ ì•Œë¦¼** - ë¡œê·¸ + ì´ë©”ì¼ + Webhook (Google Chat, Slack ë“±)
- âœ… **AI ì„ íƒ** - ê¸°ë³¸ì€ AI ì—†ìŒ, í•„ìš”ì‹œ AI ë¶„ì„ ëª¨ë“œ (ì›ì¸ ë¶„ì„, ìµœì í™” ì œì•ˆ)

---

## ğŸš€ ë¹ ë¥¸ ì‹œì‘ (3ë¶„)

### 1. ì„¤ì¹˜
```bash
cd tools/performance-test
npm install
```

### 2. ì„¤ì •
`db-monitor/config/alert-config.json` í¸ì§‘:
```json
{
  "email": {
    "smtp": {
      "auth": {
        "user": "your-email@gmail.com",
        "pass": "your-app-password"
      }
    },
    "to": ["dba@company.com"]
  }
}
```

### 3. ì‹¤í–‰
```bash
# ê¸°ë³¸ ëª¨ë“œ (AI ì—†ìŒ)
npm run monitor

# AI ëª¨ë“œ (ì›ì¸ ë¶„ì„ + ìµœì í™” ì œì•ˆ)
export ANTHROPIC_API_KEY="sk-ant-..."
npm run monitor -- --ai-mode ai-assisted
```

---

## ğŸ“Š ê°ì§€ í•­ëª©

| í•­ëª© | ì„¤ëª… | ì„ê³„ê°’ | ìƒì„¸ |
|------|------|--------|------|
| **ëŠë¦° ì¿¼ë¦¬ (ì „ì²´)** | ëª¨ë“  ì¿¼ë¦¬ ì‹¤í–‰ ì‹œê°„ ì´ˆê³¼ | 3ì´ˆ/1ì´ˆ/0.5ì´ˆ | ìë™ |
| **ì›Œì¹˜ ì¿¼ë¦¬ (ì§€ì •)** | íŠ¹ì • ì¿¼ë¦¬ë§Œ ê°ì‹œ (MyBatis XML ID) | ê°œë³„ ì„¤ì • | [ê°€ì´ë“œ](QUERY_WATCH_GUIDE.md) |
| **ì°¨ë‹¨ (Blocking)** | ì„¸ì…˜ì´ ë‹¤ë¥¸ ì„¸ì…˜ì„ ì°¨ë‹¨ | 5ì´ˆ/1ì´ˆ/0.5ì´ˆ | ì¦‰ì‹œ |
| **Lock ëˆ„ì ** | ê°™ì€ Lock ì¥ì‹œê°„ ìœ ì§€ | 10ë¶„ ì´ìƒ | ê³„ì† ì¶”ì  |
| **ë†’ì€ CPU** | CPU ì‚¬ìš©ëŸ‰ ì´ˆê³¼ | 2ì´ˆ/0.5ì´ˆ/0.3ì´ˆ | ìë™ |
| **Table Scan** | ì¸ë±ìŠ¤ ë¯¸ì‚¬ìš© | ê°ì§€ ì¦‰ì‹œ | ìë™ |
| **ë°ë“œë½** | êµì°© ìƒíƒœ | ê°ì§€ ì¦‰ì‹œ | ìë™ |

---

## ğŸ“§ ì•Œë¦¼ ì±„ë„

### 1. ë¡œê·¸ íŒŒì¼
```
logs/db-alert-2026-01-16.json (JSON í˜•ì‹, ê²€ìƒ‰ ìš©ì´)
```

### 2. ì´ë©”ì¼
- **ì œëª©**: `ğŸš¨ [CRITICAL] DB Alert - SLOW QUERY`
- **ë‚´ìš©**: ë°œìƒ ì‹œê°, ì„±ëŠ¥ ì§€í‘œ, ì¿¼ë¦¬ í…ìŠ¤íŠ¸, ê¶Œì¥ ì¡°ì¹˜

### 3. Webhook
- **Google Chat** - ì¹´ë“œ í˜•ì‹, ê°€ì¥ ê¹”ë” â­
- **Slack** - Attachment í˜•ì‹
- **Discord** - Embed í˜•ì‹, ì»¬ëŸ¬
- **MS Teams** - MessageCard í˜•ì‹

â†’ [WEBHOOK_GUIDE.md](WEBHOOK_GUIDE.md)ì—ì„œ ì„¤ì • ë°©ë²• í™•ì¸

---

## ğŸ¤– AI ëª¨ë“œ (ì„ íƒ ì‚¬í•­)

ê¸°ë³¸ ëª¨ë“œëŠ” **AI ì—†ì´** ë¬¸ìì—´ ë§¤ì¹­ë§Œ ì‚¬ìš©í•©ë‹ˆë‹¤ (ë¹„ìš© $0).

**AI ëª¨ë“œë¥¼ í™œì„±í™”í•˜ë©´**:
- `${}` ë™ì  ì¿¼ë¦¬ ìë™ ë§¤ì¹­ (ì¿¼ë¦¬ ìœ ì‚¬ë„ ë¶„ì„)
- ì„±ëŠ¥ ë¬¸ì œ **ì›ì¸ ë¶„ì„** (ì‹¤í–‰ ê³„íš + AI)
- êµ¬ì²´ì  **ìµœì í™” ì œì•ˆ** (ì¸ë±ìŠ¤ ì¶”ê°€, ì¿¼ë¦¬ ì¬ì‘ì„±)
- ì˜ˆìƒ ë¹„ìš©: **ì›” $0.75** (ai-assisted ëª¨ë“œ, ìºì‹± ì ìš© ì‹œ)

â†’ [AI_MODE.md](AI_MODE.md)ì—ì„œ ìƒì„¸ ê°€ì´ë“œ í™•ì¸

---

## ğŸ“š ìƒì„¸ ë¬¸ì„œ

| ë¬¸ì„œ | ë‚´ìš© | ì¤„ ìˆ˜ |
|------|------|-------|
| [ARCHITECTURE.md](ARCHITECTURE.md) | ì•„í‚¤í…ì²˜ ë° ì™¸ë¶€ ì‹¤í–‰ ì›ë¦¬ | 544ì¤„ |
| [QUERY_WATCH_GUIDE.md](QUERY_WATCH_GUIDE.md) | íŠ¹ì • ì¿¼ë¦¬ë§Œ ëª¨ë‹ˆí„°ë§ (MyBatis XML íŒŒì‹±) | 578ì¤„ |
| [LOCK_MONITOR_GUIDE.md](LOCK_MONITOR_GUIDE.md) | Lock ìƒì„¸ ëª¨ë‹ˆí„°ë§ (íƒ€ì…, í…Œì´ë¸”, ëˆ„ì  ì‹œê°„) | 530ì¤„ |
| [WEBHOOK_GUIDE.md](WEBHOOK_GUIDE.md) | Webhook ì•Œë¦¼ ì„¤ì • (Google Chat, Slack ë“±) | 658ì¤„ |
| [AI_MODE.md](AI_MODE.md) | AI ëª¨ë“œ ì„¤ì • ë° ë¹„ìš© ìµœì í™” | ìš”ì•½ë³¸ |
| [DB_ALERT_GUIDE.md](DB_ALERT_GUIDE.md) | ì „ì²´ ì„¤ì • ë° ê³ ê¸‰ ì‚¬ìš©ë²• | 726ì¤„ |

---

## âš™ï¸ ì£¼ìš” ê¸°ëŠ¥ ìš”ì•½

### âœ… ëŠë¦° ì¿¼ë¦¬ ì „ì²´ + ì§€ì • ì¿¼ë¦¬ ë™ì‹œ ëª¨ë‹ˆí„°ë§
- ëª¨ë“  ëŠë¦° ì¿¼ë¦¬ ìë™ ê°ì§€ (3ì´ˆ ì´ìƒ)
- íŠ¹ì • ì¿¼ë¦¬ (StockManagerImpl.listStock) ë³„ë„ ê°ì‹œ (1ì´ˆ ì´ìƒ)
- ê°ê° ë‹¤ë¥¸ ì„ê³„ê°’ ì„¤ì • ê°€ëŠ¥

### âœ… Lock ëˆ„ì  ì‹œê°„ ì¶”ì 
- ì¦‰ì‹œ ì°¨ë‹¨ ê°ì§€ (5ì´ˆ ì´ìƒ)
- ì¥ì‹œê°„ ìœ ì§€ ê°ì§€ (10ë¶„ ì´ìƒ) - Critical ì•Œë¦¼
- Lock íƒ€ì…, í…Œì´ë¸”, ì„¸ì…˜ ì •ë³´ í¬í•¨

### âœ… MyBatis ì™„ë²½ ì§€ì›
- `#{}` íŒŒë¼ë¯¸í„° (PreparedStatement)
- `${}` ë™ì  ì¹˜í™˜ (í…Œì´ë¸”ëª…, ì»¬ëŸ¼ëª…, ORDER BY)
- XML íŒŒì¼ ìë™ ë¡œë“œ ë° SQL ID ë§¤ì¹­

---

## ğŸ“ ë””ë ‰í† ë¦¬ êµ¬ì¡°

```
db-monitor/
â”œâ”€â”€ README.md                    # ì´ íŒŒì¼ (ìš”ì•½)
â”œâ”€â”€ config/
â”‚   â””â”€â”€ alert-config.json        # ì„¤ì • íŒŒì¼
â”œâ”€â”€ db-alert-monitor.js          # ë©”ì¸ ëª¨ë‹ˆí„°ë§ ìŠ¤í¬ë¦½íŠ¸
â”œâ”€â”€ query-watcher.js             # íŠ¹ì • ì¿¼ë¦¬ ê°ì‹œ
â”œâ”€â”€ lock-monitor.js              # Lock ëª¨ë‹ˆí„°ë§
â”œâ”€â”€ ai/                          # AI ëª¨ë“œ (ì„ íƒ)
â”‚   â”œâ”€â”€ ai-engine.js
â”‚   â”œâ”€â”€ cache/
â”‚   â””â”€â”€ providers/
â”œâ”€â”€ utils/
â”‚   â”œâ”€â”€ email-sender.js          # ì´ë©”ì¼ ë°œì†¡
â”‚   â”œâ”€â”€ webhook-sender.js        # Webhook ë°œì†¡
â”‚   â””â”€â”€ alert-logger.js          # ë¡œê·¸ ì €ì¥
â””â”€â”€ logs/                        # ë¡œê·¸ ì €ì¥ ë””ë ‰í† ë¦¬
```

---

## ğŸ”œ ë‹¤ìŒ ë‹¨ê³„

1. **ê¸°ë³¸ ì„¤ì •**: [DB_ALERT_GUIDE.md](DB_ALERT_GUIDE.md) ì½ê³  ì„¤ì •
2. **íŠ¹ì • ì¿¼ë¦¬ ê°ì‹œ**: [QUERY_WATCH_GUIDE.md](QUERY_WATCH_GUIDE.md)
3. **Webhook ì„¤ì •**: [WEBHOOK_GUIDE.md](WEBHOOK_GUIDE.md)
4. **AI ëª¨ë“œ**: [AI_MODE.md](AI_MODE.md) (ì„ íƒ ì‚¬í•­)

**ë°±ê·¸ë¼ìš´ë“œ ì‹¤í–‰**:
```bash
nohup npm run monitor > monitor.log 2>&1 &
```

**ë¡œê·¸ í™•ì¸**:
```bash
tail -f db-monitor/logs/db-alert-$(date +%Y-%m-%d).json
```

---

**ë²„ì „**: 2.0 (AI ëª¨ë“œ ì¶”ê°€)
**ì‘ì„±ì¼**: 2026-01-16
**ë¬¸ì˜**: GitHub Issues
